---
import '../styles/global.css';
import { getLocalizedPath, getOgLocale, toLanguage } from '../i18n/utils';
import { languages, defaultLang, type Language } from '../i18n/ui';
import { getPrivacy, getFooter, getUi } from '../content/helpers';

interface Props {
  lang?: Language;
}

const { lang = toLanguage(Astro.currentLocale) } = Astro.props;
const ogLocale = getOgLocale(lang);
const canonicalBase = 'https://wombat-apps.com';
const canonicalPath = lang === 'en' ? '/privacy-policy' : `/${lang}/privacy-policy`;
const canonicalUrl = `${canonicalBase}${canonicalPath}`;
const homePath = getLocalizedPath(lang, '/');

// Load content from collections
const privacy = await getPrivacy(lang);
const footer = await getFooter(lang);
const ui = await getUi(lang);

if (!privacy || !footer || !ui) {
  throw new Error(`Missing content for privacy page in ${lang}`);
}

// Language selector helper for privacy pages
function getLanguageLink(targetLang: Language): string {
  if (targetLang === defaultLang) return '/privacy-policy';
  return `/${targetLang}/privacy-policy`;
}
---

<!DOCTYPE html>
<html lang={lang}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{privacy.title} - Bingo!!</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content={privacy.subtitle}>
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#822ad2">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="canonical" href={canonicalUrl}>

    <!-- Open Graph -->
    <meta property="og:title" content={`${privacy.title} - Bingo!!`}>
    <meta property="og:description" content={privacy.subtitle}>
    <meta property="og:url" content={canonicalUrl}>
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Bingo!!">
    <meta property="og:locale" content={ogLocale}>

    <!-- Hreflang -->
    <link rel="alternate" hreflang="en" href={`${canonicalBase}/privacy-policy`}>
    <link rel="alternate" hreflang="es" href={`${canonicalBase}/es/privacy-policy`}>
    <link rel="alternate" hreflang="fr" href={`${canonicalBase}/fr/privacy-policy`}>
    <link rel="alternate" hreflang="pt" href={`${canonicalBase}/pt/privacy-policy`}>
    <link rel="alternate" hreflang="x-default" href={`${canonicalBase}/privacy-policy`}>

    <!-- Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body class="bg-white font-sans">
    <!-- Skip Link -->
    <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:bg-white focus:text-bingo-purple focus:px-4 focus:py-2 focus:rounded-lg focus:shadow-lg focus:font-semibold">
        {ui.accessibility.skipToContent}
    </a>

    <!-- Header -->
    <header class="bg-gradient-to-br from-purple-50 via-blue-50 to-pink-50 py-16">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <a href={homePath} class="inline-block mb-8">
                    <img src="/images/bingo-logo.png" alt="Bingo!! Logo" class="h-16 mx-auto">
                </a>
                <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
                    {privacy.title}
                </h1>
                <p class="text-xl text-gray-600">
                    {privacy.subtitle}
                </p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main" class="py-16">
        <div class="container mx-auto px-4 max-w-4xl">
            <div class="prose prose-lg mx-auto">
                <section class="mb-12">
                    <p class="text-gray-600 leading-relaxed mb-8">
                        {privacy.intro}
                    </p>
                </section>

                {privacy.sections.map((section: { key: string; title: string; content: string }) => (
                    <section class="mb-12">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">{section.title}</h2>
                        <p class="text-gray-600 leading-relaxed mb-4">
                            {section.content}
                        </p>
                        {section.key === 'infoCollection' && (
                            <ul class="text-gray-600 leading-relaxed space-y-2 mb-4">
                                <li>â€¢ <a href="https://www.apple.com/legal/privacy/en/" class="text-bingo-purple hover:text-bingo-pink transition-colors" target="_blank" rel="noopener noreferrer">{privacy.applePrivacyPolicy}</a></li>
                            </ul>
                        )}
                    </section>
                ))}

                <section class="mb-12">
                    <div class="bg-gray-50 rounded-lg p-6">
                        <p class="text-gray-600 font-semibold">
                            <strong>{privacy.contact.emailLabel}</strong> <a href="mailto:support@wombat-apps.com" class="text-bingo-purple hover:text-bingo-pink transition-colors">support@wombat-apps.com</a><br>
                            <strong>{privacy.contact.websiteLabel}</strong> <a href="http://wombat-apps.com" class="text-bingo-purple hover:text-bingo-pink transition-colors">http://wombat-apps.com</a>
                        </p>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-4 text-center">
            <a href={homePath} class="inline-block mb-6">
                <img src="/images/bingo-logo.png" alt="Bingo!! Logo" class="h-16 mx-auto opacity-80">
            </a>
            <p class="text-lg text-gray-300 mb-4">{footer.rights}</p>
            <p class="text-gray-400 mb-6">{footer.tagline}</p>

            <!-- Language Selector -->
            <div class="flex justify-center space-x-4">
                {Object.entries(languages).map(([code]) => (
                    <a href={getLanguageLink(code as Language)} class={`language-link px-4 py-2 rounded-lg font-medium transition-colors ${code === lang ? 'bg-bingo-purple text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white'}`} aria-current={code === lang ? 'page' : undefined} data-lang={code}>
                        {code.toUpperCase()}
                    </a>
                ))}
            </div>
        </div>
    </footer>

    <script>
        // Language selector storage
        document.querySelectorAll('.language-link').forEach(link => {
            link.addEventListener('click', () => {
                const lang = link.getAttribute('data-lang') || 'en';
                localStorage.setItem('preferred-language', lang);
            });
        });
    </script>
</body>
</html>
